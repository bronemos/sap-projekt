---
title: "Analiza kriminala i socio-ekonomskih faktora"
author:
- Jan Grgić
- Bernard Spiegl
- Korina Šimičević
- Dunja Šmigovec
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Uvod

Cilj ovog projekta je analizirati podatke o kriminalu na području Chicaga bilježene u periodu od godinu dana.

## Učitavanje paketa

```{r echo=T, error=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
```

## Učitavanje podataka

```{r}
chicago_year = read.csv("data/Crimes_-_One_year_prior_to_present.csv")
chicago_pc = read.csv("data/Chicago_poverty_and_crime.csv")
dim(chicago_pc)
dim(chicago_year)
```

## Učitavanje podataka o vremenu

```{r}
#vadi listu datuma
dates <-
  strptime(c(chicago_year$DATE..OF.OCCURRENCE),
           format = "%m/%d/%Y %H:%M:%S %p",
           tz = "America/Chicago")

#vadi listu sati
hours <-
  as.numeric(format(
    strptime(
      chicago_year$DATE..OF.OCCURRENCE,
      format = "%m/%d/%Y %I:%M:%S %p",
      tz = "America/Chicago"
    ),
    format = "%H"
  ))
table(hours)
```

## Podaci o učestalosti kriminala ovisno o dobu dana

```{r}
hist(
  hours + 1,
  breaks = 0:24,
  main = "Učestalost kriminala ovisno o dobu dana",
  xlab = "Sat u danu",
  ylab = "Frekvencija",
  col = "light blue",
  xaxt = "n"
)
axis(side = 1,
     at = seq(0, 24, 2),
     tick = T)
rug(seq(1, 23, 2), ticksize = -0.03, side = 1)
```

```{r}
categories <- unique(chicago_year$PRIMARY.DESCRIPTION)
cat("Kategorije kriminalnih radnji\n")
categories
length(categories)

theft <- chicago_year[chicago_year$PRIMARY.DESCRIPTION == "THEFT", ]
theft_hours <-
  scale(table(as.numeric(format(
    strptime(theft$DATE..OF.OCCURRENCE, format = "%m/%d/%Y %I:%M:%S %p", tz =
               "America/Chicago"),
    format = "%H"
  ))))


homicide <-
  chicago_year[chicago_year$PRIMARY.DESCRIPTION == "HOMICIDE", ]
homicide_hours <-
  scale(table(as.numeric(format(
    strptime(
      homicide$DATE..OF.OCCURRENCE,
      format = "%m/%d/%Y %I:%M:%S %p",
      tz = "America/Chicago"
    ),
    format = "%H"
  ))))

plot(
  homicide_hours,
  type = "l",
  main = "Relativan odnos učestalosti ubojstava i krađa tokom dana",
  xlab = "Sat u danu",
  ylab = "Učestalost",
  xaxt = "n",
  yaxt = "n"
)
lines(theft_hours, col = "red")
lines(homicide_hours, col = "blue")
axis(side = 1,
     at = seq(1, 23, 2),
     tick = T)
rug(seq(0, 24, 2), ticksize = -0.03, side = 1)
legend("topright", c("Krađe", "Ubojstva"), fill = c(rgb(1, 0, 0, 0.5), rgb(0, 0, 1, 0.5)))


```
## Odnos stope ubojstava i BDP per Capita
```{r}
homicide_gdp <-
  data.frame(x = chicago_pc$Per.Capita.Income,
             y = chicago_pc$Assault..Homicide.)
plot(homicide_gdp,
     main = "Stopa ubojstava u ovisnosti o BDP per capita",
     xlab = "BDP per capita (US$)",
     ylab = "Stopa ubojstava (/100 000)")
```
## Odnos stope krađa i BDP per capita
```{r}
```

## Prikaz frekvencija različitih tipova zločina unazad godinu dana
```{r}
table <- table(chicago_year$PRIMARY.DESCRIPTION)
data <- as.data.frame.table(table)


df <- data[order(data$Freq, decreasing = TRUE),]
op <- par(mar = c(12, 4, 1, 2))
barplot(
  df$Freq,
  names.arg = df$Var1,
  las = 2,
  cex.names = 0.6,
  col = "skyblue",
  ylim = range(pretty(c(0, df$Freq))),
  main = "Frekvencije različitih tipova zločina"
)

```

## Prikaz tipova zločina koji su se pojavili manje od 2000 puta unazad godinu dana
```{r}
dfs <- df[df$Freq < 2000, ]
op <- par(mar = c(13, 4, 1, 2))
barplot(
  dfs$Freq,
  names.arg = dfs$Var1,
  las = 2,
  cex.names = 0.7,
  col = "skyblue",
  ylim = range(pretty(c(0, 2000)))
)


```


## Usporedba učestalosti krađa s učestalosti kriminala vezanih uz narkotike

```{r}

```

## Zavisnosti različitih socio-ekonomskih faktora
Prije nego što krenemo na veze između socio-ekonomskih faktora i kategorije kriminala, prvo nas zanima kakve su zavisnosti između različitih socio-ekonomskih faktora. U tu svrhu, ispitali smo nekoliko korelacijskih koeficijenata za varijable za koje smatramo da bi mogle biti povezane.

Prva varijabla je Below.Poverty.Level za koji smatramo da bi trebala biti u korelaciji s varijablama Unemployment, No.High.School.Diploma, Crowded.Housing i Per.Capita.Income. 

```{r}
cor(chicago_pc$Below.Poverty.Level, chicago_pc$Unemployment)
```
```{r}
cor(chicago_pc$Below.Poverty.Level, chicago_pc$No.High.School.Diploma)
```
```{r}
cor(chicago_pc$Below.Poverty.Level, chicago_pc$Crowded.Housing)
```
```{r}
cor(chicago_pc$Below.Poverty.Level, chicago_pc$Per.Capita.Income)
```
Najveću pozitivnu korelaciju smo dobili za par varijabli Below.Poverty.Level i Unemployment. Dosta dobru negativnu korelaciju dobili smo za par varijabli Below.Poverty.Level i Per.Capita.Income. Možemo zaključiti da je nezaposlenost veliki razlog zašto netko živi ispod granice siromaštva. Iz negativne korelacije između Below.Poverty.Level i Per.Capita.Income mogli bismo pretpostaviti da su kvartovi eventualno grupirani po socijalnom statusu te bogatiji kvartovi imaju manje siromašnih ljudi. Za varijable No.High.School.Diploma i Crowded.Housing dobivamo očekivanu pozitivnu korelaciju.


Sljedeća varijabla koja je zanimljiva je varijabla Unemployment. Vidjeli smo da su ona i Below.Poverty.Line u jakoj pozitivnoj korelacijskoj vezi. Zanima nas znači li veći postotak ljudi koji nemaju završenu srednju školu i veću nezaposlenost. 

```{r}
cor(chicago_pc$Unemployment, chicago_pc$No.High.School.Diploma)
```

Očekivana pozitivna korelacija je prisutna, ali ne u onoj količini koju smo možda očekivali.

Zanima nas kako se ponašaju varijable Unemployment i Dependecy.

```{r}
cor(chicago_pc$Dependency, chicago_pc$Unemployment)
```
Uočavamo dosta visoku pozitivnu korelaciju.  //EXPLAIN MORE 


Za varijable Unemployment i Crowded.Housing očekujemo pozitivnu korelaciju. Naime, ako netko nema posao onda vjerojatno nema ni dovoljno za stanarinu koja bi odgovarala veličini prostora koji je potreban za zdrav život.

```{r}
cor(chicago_pc$Unemployment, chicago_pc$Crowded.Housing)
```
Dobivamo slabu pozitivinu korelaciju. Podosta slabiju od očekivane.
Kako smo dobili broj koji je blizu 0, ovaj primjer je dobar kandidant da napravimo korelacijski test.

```{r}
cor.test(chicago_pc$Unemployment, chicago_pc$Crowded.Housing)
```
P-vrijednost testa je 0.2105. To znači da u slučaju da varijable Unemployment i Crowded.Housing nisu u nikakvoj korelaciji (tj. korelacija je 0), vjerojatnost da dobijemo pozitivnu korelaciju od 0.144 i više je 21%. Možemo posumnjati u pozitivnu korelaciju ove dvije varijable. 

```{r}
cor(chicago_pc$Unemployment, chicago_pc$Per.Capita.Income)
```
Za varijable Unemployment i Per.Capita.Income uočavamo dosta jaku negativnu korelaciju što je očekivano. Kvartovi s većom zapošljenosti imaju i veći prihod.

Dalje gledamo kako se varijabla Per.Capita.Income ponaša u kombinaciji s drugima. Već smo primjetili da su Unemployment i Below.Poverty.Line usko povezani, a nakon toga da je Per.Capita.Income u negativnoj korelaciji s obije varijable. S tim da je više negativno koreliran s varijablom Unemployment. Također smo primjetili da su varijable Unemployment i No.High.School.Diploma u nešto slabijoj pozitivnoj korelaciji (0.32). Međutim, očekujemo da će varijable Per.Capita.Income i No.High.School.Diploma biti u nešto jačoj vezi. Očekujemo da veći postotak školovanih ljudi daje i veće prihode. 

```{r}
cor(chicago_pc$Per.Capita.Income, chicago_pc$No.High.School.Diploma)
```
Ako manji Dependecy znači zdraviju i bogatiju ekonomiju, onda također očekujemo da će varijable Dependecy i Per.Capita.Income biti jako negativno korelirane.

```{r}
cor(chicago_pc$Per.Capita.Income, chicago_pc$Dependency)
```
Očekujemo da Per.Capita.Income ima dosta jak utjecaj na varijablu Crowded.Housing, tj. ako je kvart bogatiji, onda očekujemo puno manji broj ljudi koji živi u premalih domovima.

```{r}
cor(chicago_pc$Per.Capita.Income, chicago_pc$Crowded.Housing)
```
Dobivamo očekivanu negativnu korelaciju, ali kao i kod varijabla Unemployment i Crowded.Housing, nešto slabiju od očekivane vrijednosti. Ipak, dobiveni broj nije blizu 0 u smislu da bismo posumjnali u negativnu korelaciju ove dvije varijable.

Međutim, i dalje nismo našli nijednu varijblu koja jako dobro objašnjava Crowded.Housing. Očekivali smo da će Unemployment to najbolje objasniti, ali smo došli do zaključka da Unemployment ima dobru vjerojatnost da uopće ne objašnjava zašto ljudi žive u premalim prostorima. Per.Capita.Income daje neke odgovore na ta pitanja, međutim pitanje je postoji li varijabla koja to radi bolje. 

Uz malo isprobavanja, došli smo do sljedećeg:

```{r}
cor(chicago_pc$No.High.School.Diploma, chicago_pc$Crowded.Housing)
```
Ovo je najjača korelacija koju smo vidjeli do sada, te ako napravimo test...

```{r}
cor.test(chicago_pc$No.High.School.Diploma, chicago_pc$Crowded.Housing)
```
... vidimo da je 95%-tni interval između 0.85 i 0.93. Zaključujemo da su ove dvije varijable zaista jako zavisne. Iz tog razloga, možemo zaključiti da manjak obrazovanja najviše pridonosi prenatrpanim domovima. Vidjeli smo prije da su varijable No.High.School.Diploma i Per.Capita.Income dosta jako negativno korelirane (-0.70), međutim postavlja se pitanje zašto onda Per.Capita.Income i Crowded.Housing nisu jače korelirane?

Ovo je dobar primjer da probamo napraviti linearnu regresiju i pogledamo kako to sve izgleda. 

```{r}
x <- as.matrix(chicago_pc[8]) #No.High.School.Diploma
y <- as.matrix(chicago_pc[6]) #Crowded.Housing

reg1 <- lm(y ~ x, chicago_pc)

summary(reg1)

```
```{r}
plot(
  x,
  y,
  pch = 16,
  cex = 1.3,
  col = "lightgreen",
  xlab = "Percentage of people without high school diploma",
  ylab = "Percentage of people living in crowded houses",
)
abline(lm(y ~ x), col = "pink", lwd = 2)
```
Probat ćemo dodati i Per.Capita.Income u ovu priču i pogledati kako se model ponaša u toj situaciji.

```{r}
x1 <- as.matrix(chicago_pc[9]) #Per.Capita.Income

reg2 <- lm(y ~ x + x1, chicago_pc)

summary(reg2)
```
Vidimo da smo dobili nešto bolji model. Smanjili smo std. error svih koeficijenata, povećali smo značajnost koeficijenta b0 i povećali smo koeficijent determinacije.

## Veze između socio-ekonomskih faktora i kategorije kriminala

```{r}

```