---
title: "**Analiza kriminala i socio-ekonomskih faktora**"
author:
- Jan Grgić
- Bernard Spiegl
- Korina Šimičević
- Dunja Šmigovec
output:
  pdf_document: default
header-includes:
  \usepackage{float}
  \floatplacement{figure}{H}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Uvod

Cilj ovog projekta je analizirati i vizualno prikazati podatke o kriminalu na području Chicaga bilježene u periodu od godinu dana.

## Učitavanje paketa

```{r echo=T, error=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
```

## Učitavanje podataka

```{r}
chicago_year = read.csv("data/Crimes_-_One_year_prior_to_present.csv")
chicago_pc = read.csv("data/Chicago_poverty_and_crime.csv")
dim(chicago_pc)
dim(chicago_year)
```

## Učitavanje podataka o vremenu

```{r}
#dohvaća listu datuma
dates <-
  strptime(c(chicago_year$DATE..OF.OCCURRENCE),
           format = "%m/%d/%Y %H:%M:%S %p",
           tz = "America/Chicago")

#dohvaća listu sati
hours <-
  as.numeric(format(
    strptime(
      chicago_year$DATE..OF.OCCURRENCE,
      format = "%m/%d/%Y %I:%M:%S %p",
      tz = "America/Chicago"
    ),
    format = "%H"
  ))
table(hours)
```

## Podaci o učestalosti kriminala ovisno o dobu dana

Promotrimo najprije ovisnost frekventnosti kriminalnih aktivnosti o trenutku u danu (Figure \ref{fig:frequency_hist}).\
Inicijalna pretpostavka većine je vjerojatno da su kriminalne aktivnosti najfrekventnije u noćnim satima, ali histogram nam pokazuje drukčije.

```{r frequency_hist, fig.cap = "Frekventnost kriminalnih radnji u periodu od 24 sata", out.width='0.9\\linewidth'}
hist(
  hours + 1,
  breaks = 0:24,
  main = "Frequency of criminal activities in 24 hours",
  xlab = "Hour",
  ylab = "Frequency",
  col = "light blue",
  xaxt = "n"
)
axis(side = 1,
     at = seq(0, 24, 2),
     tick = T)
rug(seq(1, 23, 2), ticksize = -0.03, side = 1)
```
Razlog ovakvog izgleda histograma je činjenica da sve kriminalne radnje promatramo zajedno, kasnije ćemo vidjeti da uzimanjem određenog tipa kriminala dolazimo do drukčijeg izgleda aktivnosti tokom dana.\

## Kategorije kriminala u datasetu
```{r}
categories <- unique(chicago_year$PRIMARY.DESCRIPTION)
categories
length(categories)
```

## Prikaz frekvencija različitih kategorija zločina unazad godinu dana

U nastavku (Figure \ref{fig:category_frequencies}) možemo vidjeti da je su najčešći lakši oblici zločina što je bilo i za očekivati.
```{r category_frequencies, fig.cap = "Frekventnost kategorija unazad godinu dana", out.width='0.9\\linewidth'}
table <- table(chicago_year$PRIMARY.DESCRIPTION)
data <- as.data.frame.table(table)


df <- data[order(data$Freq, decreasing = TRUE),]
op <- par(mar = c(12, 4, 1, 2))
barplot(
  df$Freq,
  names.arg = df$Var1,
  las = 2,
  cex.names = 0.6,
  col = "skyblue",
  ylim = range(pretty(c(0, df$Freq))),
  main = "Frequency of different crime activities"
)

```

## Prikaz kategorija zločina koji su se pojavili manje od 2000 puta unazad godinu dana

Promotrimo li kategorije zločina koje s frekvencijama manjim od 2000 (Figure \ref{fig:sub_2000}) uočavamo možemo vidjeti međusoban odnos frekventnosti težih kriminalnih radnji.
```{r sub_2000, fig.cap = "Kategorije kriminala s frekvencijom <2000", out.width='0.9\\linewidth'}
dfs <- df[df$Freq < 2000, ]
op <- par(mar = c(13, 4, 1, 2))
barplot(
  dfs$Freq,
  names.arg = dfs$Var1,
  las = 2,
  cex.names = 0.7,
  col = "skyblue",
  ylim = range(pretty(c(0, 2000))),
  main = "Crimes with a frequency <2000"
)


```

## Prikaz relativnog odnosa količine ubojstava i krađa u periodu od 24 sata

U nastavku možemo vidjeti graf koji prikazuje relativan odnos frekventnosti krađa i ubojstava u periodu od 24 sata (Figure \ref{fig:homicide_theft}).\
S obzirom da su podaci skalirani radi se isključivo o relativnom prikazu.\
Uočljivo je da se ubojstva češće događaju u kasnijim satima i tokom noći dok su krađe češće sredinom dana.
```{r homicide_theft, warning=FALSE, fig.cap = "Prikaz relativnog odnosa količine ubojstava i krađa u periodu od 24 sata", out.width='0.9\\linewidth'}
theft <- chicago_year[chicago_year$PRIMARY.DESCRIPTION == "THEFT",]
theft_hours <-
  scale(table(as.numeric(format(
    strptime(theft$DATE..OF.OCCURRENCE, format = "%m/%d/%Y %I:%M:%S %p", tz =
               "America/Chicago"),
    format = "%H"
  ))))


homicide <-
  chicago_year[chicago_year$PRIMARY.DESCRIPTION == "HOMICIDE",]
homicide_hours <-
  scale(table(as.numeric(format(
    strptime(
      homicide$DATE..OF.OCCURRENCE,
      format = "%m/%d/%Y %I:%M:%S %p",
      tz = "America/Chicago"
    ),
    format = "%H"
  ))))


plot(
  homicide_hours,
  type = "l",
  main = "Comparison of relative frequencies of homicide and theft in 24 hours",
  xlab = "Hour",
  ylab = "Frequency",
  xaxt = "n",
  yaxt = "n"
)
lines(theft_hours, col = "red")
lines(homicide_hours, col = "blue")
axis(side = 1,
     at = seq(1, 23, 2),
     tick = T)
rug(seq(0, 24, 2), ticksize = -0.03, side = 1)
legend("bottomright", c("Theft", "Homicide"), fill = c(rgb(1, 0, 0, 0.5), rgb(0, 0, 1, 0.5)))

```
## Odnos stope ubojstava i BDP per Capita
Promatranjem odnosa stope ubojstava i BDP per Capita (Figure \ref{fig:homicide_gdp}) uočavamo da su stope ubojstava znatno veće u područjima nižeg BDP per Capita.\
Jedan od razloga takvog trenda može biti raslojenost populacije po kvartovima, pa tako bogatiji dio populacije živi u sigurnijim kvartovima sa manje kriminala.
```{r homicide_gdp, fig.cap = "Odnos stope ubojstava i BDP per Capita", out.width='0.9\\linewidth'}
homicide_gdp <-
  data.frame(x = chicago_pc$Per.Capita.Income,
             y = chicago_pc$Assault..Homicide.)
plot(homicide_gdp,
     main = "Homicide rate in relation to GDP per capita",
     xlab = "GDP per capita (US$)",
     ylab = "Homicide rate (n/100 000)")
```
## Odnos stope krađa i BDP per capita msm da je nespojivo, krade imamo samo u chicago_year, a tamo ne znamo BDP

## Usporedba učestalosti krađa s učestalosti kriminala vezanih uz narkotike
Promatranjem kretanja broja krađa i kriminala povezanog s narkoticima (Figure \ref{fig:theft_vs_narcotics}) može se uočiti da se broj krađa i broj kriminalnih djela povezanih s narkoticima podjednako mijenjaju. Izgleda kao da brojka obje vrste kriminalnih djela istovremeno pada odnosno raste. To nam dokazuje i vrlo visoka korelacija (0.7119473)

```{r theft_vs_narcotics, fig.cap = "Usporedba broja krađa i kriminala vezanog za narkotike u periodu od godinu dana", out.width='0.9\\linewidth'}

theft <- chicago_year[chicago_year$PRIMARY.DESCRIPTION == "THEFT",]
theft_dates <-
  table(as.Date(
    strptime(theft$DATE..OF.OCCURRENCE, format = "%m/%d/%Y %I:%M:%S %p", tz =
               "America/Chicago"),
  ))

narcotics <-
  chicago_year[chicago_year$PRIMARY.DESCRIPTION == "NARCOTICS",]
narcotics_dates <-
  table(as.Date(
    strptime(narcotics$DATE..OF.OCCURRENCE, format = "%m/%d/%Y %I:%M:%S %p", tz =
               "America/Chicago"),
  ))

plot(
  theft_dates,
  type = "l",
  main = "Comparison of number of crimes related to\ntheft and narcotics in a year",
  xlab = "Date",
  ylab = "Number of crimes",
)
lines(theft_dates, col = "red")
lines(narcotics_dates, col = "blue")
legend("topright", c("Theft", "Narcotics"), fill = c(rgb(1, 0, 0, 0.5), rgb(0, 0, 1, 0.5)))

cor(theft_dates, narcotics_dates)

```


## Zavisnosti različitih socio-ekonomskih faktora
Prije nego što krenemo na veze između socio-ekonomskih faktora i kategorije kriminala, prvo nas zanima kakve su zavisnosti između različitih socio-ekonomskih faktora. U tu svrhu, napravili smo korelacijsku matricu.

```{r}
library(corrplot)
matrixData <- chicago_pc[, c(-1, -2, -3, -4)]
matrix <- cor(matrixData)
matrix
```
Uzmimo na primjer varijablu Below.Poverty.Level i pogledajmo kako se ona ponaša.
Najveću pozitivnu korelaciju smo dobili za par varijabli Below.Poverty.Level i Unemployment (0.76). Dosta dobru negativnu korelaciju dobili smo za par varijabli Below.Poverty.Level i Per.Capita.Income (-0.53). Možemo zaključiti da je nezaposlenost veliki razlog zašto netko živi ispod granice siromaštva. Iz negativne korelacije između Below.Poverty.Level i Per.Capita.Income mogli bismo pretpostaviti da su kvartovi eventualno grupirani po socijalnom statusu te bogatiji kvartovi imaju manje siromašnih ljudi.

Za varijable Unemployment i Crowded.Housing dobivamo slabu pozitivinu korelaciju (0.14). Za te smo varijable očekivali pozitivnu korelaciju. Naime, ako netko nema posao onda vjerojatno nema ni dovoljno za stanarinu koja bi odgovarala veličini prostora koji je potreban za zdrav život. Međutim broj koji smo dobili je puno manji od očekivanog.

Kako smo dobili broj koji je blizu 0, ovaj primjer je dobar kandidant da napravimo korelacijski test.

```{r}
cor.test(chicago_pc$Unemployment, chicago_pc$Crowded.Housing)
```
P-vrijednost testa je 0.2105. To znači da u slučaju da varijable Unemployment i Crowded.Housing nisu u nikakvoj korelaciji (tj. korelacija je 0), vjerojatnost da dobijemo pozitivnu korelaciju od 0.144 i više je 21%. Možemo posumnjati u pozitivnu korelaciju ove dvije varijable. 

Od drugih očekivanih vrijednosti imamo Per.Capita.Income i No.High.School.Diploma (-0.71). Ima smisla da su kvartovi siromašniji što je manji stupanj edukacije ljudi koji žive tamo.
Također ako manji Dependecy znači zdraviju i bogatiju ekonomiju, onda također očekujemo da će varijable Dependecy i Per.Capita.Income biti jako negativno korelirane što i jesu (-0.76).

Najveća vrijednost koja nije korelacija varijable sa samom sobom vidimo u slučaju No.High.School.Diploma i Crowded.Housing (0.91). Ovo je dosta zanimljiv i na prvi pogled jako neočekivani rezultat koji smo dobili. Sljedće što smo napravili je test.

```{r}
cor.test(chicago_pc$No.High.School.Diploma, chicago_pc$Crowded.Housing)
```
Vidimo da je 95%-tni interval između 0.85 i 0.93. Zaključujemo da su ove dvije varijable zaista jako zavisne. Iz tog razloga, možemo zaključiti da manjak obrazovanja najviše pridonosi prenatrpanim domovima. Međutim još uvijek ne znamo objasniti zašto je to tako. 

Ovo je dobar primjer da probamo napraviti linearnu regresiju i pogledamo kako to sve izgleda (Figure \ref{fig:regression}).

```{r}
x <- as.matrix(chicago_pc[8]) #No.High.School.Diploma
y <- as.matrix(chicago_pc[6]) #Crowded.Housing

reg1 <- lm(y ~ x, chicago_pc)

summary(reg1)

```
```{r regression, fig.cap = "Prikaz linearne regresije", out.width='0.9\\linewidth'}
plot(
  x,
  y,
  pch = 16,
  cex = 1.3,
  col = "lightgreen",
  xlab = "Percentage of people without high school diploma",
  ylab = "Percentage of people living in crowded houses",
)
abline(lm(y ~ x), col = "pink", lwd = 2)
```
Probat ćemo dodati i Per.Capita.Income u ovu priču i pogledati kako se model ponaša u toj situaciji.

```{r}
x1 <- as.matrix(chicago_pc[9]) #Per.Capita.Income

reg2 <- lm(y ~ x + x1, chicago_pc)

summary(reg2)
```
Vidimo da smo dobili nešto bolji model. Smanjili smo std. error svih koeficijenata, povećali smo značajnost koeficijenta b0 i povećali smo koeficijent determinacije. Sljedeće što trebamo napraviti je pogledati standardizirane reziduale. 

```{r}
reg2.stdres = rstandard(reg2)
plot(chicago_pc$No.High.School.Diploma, reg2.stdres, 
     xlab = "No high school diploma",
     ylab = "Standardized residuals")
 abline(0, 0)
```
Vidimo da su skoro sve osim nekoliko vrijednosti između -2 i 2 što je vrlo prihvatljivi rezultat. Skoro identičnu sitauciju dobivamo ako ubacimo Per.Capita.Income i Crowded.Housing.

```

## Veze između socio-ekonomskih faktora i kategorije kriminala

```{r}

```